<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barbearia Murilo - Sistema Profissional</title>

<style>
body{
  font-family:Segoe UI,Arial;
  background:linear-gradient(135deg,#0f0f0f,#1f1f1f);
  color:#fff;
  margin:0;
}

header{
  background:#000;
  padding:15px;
  text-align:center;
  font-size:24px;
  color:#ff3c00;
  font-weight:bold;
  box-shadow:0 0 10px #ff3c00;
}

.container{
  max-width:600px;
  margin:30px auto;
  background:#181818;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 20px rgba(255,60,0,0.2);
}

input,select,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:6px;
  border:none;
}

button{
  background:#ff3c00;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  background:#ff5c2a;
}

.hidden{
  display:none;
}

.card{
  background:#222;
  padding:10px;
  margin:5px 0;
  border-radius:6px;
}
</style>

</head>
<body>

<header>Barbearia Murilo - Sistema</header>

<div class="container" id="loginBox">
<h2>Login / Cadastro</h2>

<input id="user" placeholder="Usuário">
<input id="pass" type="password" placeholder="Senha">

<button onclick="login()">Entrar</button>
<button onclick="register()">Cadastrar</button>

<select id="roleSelect">
<option value="cliente">Cliente</option>
<option value="barbeiro">Barbeiro</option>
<option value="admin">Admin</option>
</select>

<p id="msg"></p>

</div>

<div class="container hidden" id="clienteBox">

<h2>Agendar</h2>

<input type="date" id="date">
<input type="time" id="time">

<button onclick="agendar()">Agendar</button>

<h3>Horários bloqueados</h3>
<div id="blockedList"></div>

<button onclick="logout()">Sair</button>

</div>

<div class="container hidden" id="barberBox">

<h2>Painel Barbeiro</h2>

<div id="appointments"></div>

<button onclick="logout()">Sair</button>

</div>

<div class="container hidden" id="adminBox">

<h2>Painel Admin</h2>

<h3>Bloquear horário</h3>

<input type="date" id="blockDate">
<input type="time" id="blockTime">

<button onclick="blockTime()">Bloquear</button>

<h3>Horários bloqueados</h3>
<div id="blockedAdmin"></div>

<h3>Agendamentos</h3>
<div id="appointmentsAdmin"></div>

<button onclick="logout()">Sair</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, child, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig={

apiKey:"SUA_API_KEY",
authDomain:"SEU_AUTH_DOMAIN",
databaseURL:"SEU_DATABASE_URL",
projectId:"SEU_PROJECT_ID",
storageBucket:"SEU_STORAGE_BUCKET",
messagingSenderId:"SEU_SENDER_ID",
appId:"SEU_APP_ID"

};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

let currentUser=null;

window.register=async()=>{

const u=user.value;
const p=pass.value;
const r=roleSelect.value;

await set(ref(db,"users/"+u),{

user:u,
pass:p,
role:r

});

msg.innerText="Conta criada";

};

window.login=async()=>{

const u=user.value;
const p=pass.value;

const snap=await get(child(ref(db),"users/"+u));

if(!snap.exists()){

msg.innerText="Não existe";
return;

}

const data=snap.val();

if(data.pass!==p){

msg.innerText="Senha errada";
return;

}

currentUser=data;

loginBox.classList.add("hidden");

if(data.role==="cliente"){

clienteBox.classList.remove("hidden");
loadBlocked();

}

if(data.role==="barbeiro"){

barberBox.classList.remove("hidden");
loadAppointments();

}

if(data.role==="admin"){

adminBox.classList.remove("hidden");
loadBlockedAdmin();
loadAppointmentsAdmin();

}

};

window.agendar=async()=>{

const d=date.value;
const t=time.value;

const blocked=await get(child(ref(db),"blocked/"+d+"_"+t));

if(blocked.exists()){

alert("Horário bloqueado");
return;

}

await push(ref(db,"appointments"),{

user:currentUser.user,
date:d,
time:t

});

alert("Agendado");

};

window.blockTime=async()=>{

const d=blockDate.value;
const t=blockTime.value;

await set(ref(db,"blocked/"+d+"_"+t),{

date:d,
time:t

});

};

function loadBlocked(){

onValue(ref(db,"blocked"),snap=>{

blockedList.innerHTML="";

snap.forEach(c=>{

const b=c.val();

blockedList.innerHTML+=`<div class="card">${b.date} ${b.time}</div>`;

});

});

}

function loadBlockedAdmin(){

onValue(ref(db,"blocked"),snap=>{

blockedAdmin.innerHTML="";

snap.forEach(c=>{

const key=c.key;
const b=c.val();

blockedAdmin.innerHTML+=`

<div class="card">

${b.date} ${b.time}

<button onclick="removeBlocked('${key}')">Remover</button>

</div>`;

});

});

}

window.removeBlocked=async(key)=>{

await remove(ref(db,"blocked/"+key));

};

function loadAppointments(){

onValue(ref(db,"appointments"),snap=>{

appointments.innerHTML="";

snap.forEach(c=>{

const a=c.val();

appointments.innerHTML+=`

<div class="card">

${a.user} - ${a.date} ${a.time}

</div>`;

});

});

}

function loadAppointmentsAdmin(){

onValue(ref(db,"appointments"),snap=>{

appointmentsAdmin.innerHTML="";

snap.forEach(c=>{

const a=c.val();

appointmentsAdmin.innerHTML+=`

<div class="card">

${a.user} - ${a.date} ${a.time}

</div>`;

});

});

}

window.logout=()=>location.reload();

</script>

</body>
</html>
